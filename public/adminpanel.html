<!DOCTYPE html>
<!--  Website template by freewebsitetemplates.com  -->
<html>
  <head>
    <script
      src="https://kit.fontawesome.com/0724588e9e.js"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sora&display=swap"
      rel="stylesheet"
    />
    <title>Pet Shop</title>
    <meta charset="iso-8859-1" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />

    <script>
      function showTable() {
        fetch("/getProduct")
          .then((response) => response.text())
          .then((data) => {
            var productTypes = JSON.parse(data);
            var myTables = "";
            productTypes.forEach((product) => {
              myTables += `
                                   <tr category="${product.category}" quantity="${product.quantity}">
                                       <td>${product.name}</td>
                                       <td>${product.price}</td>
      						<td>${product.quantity}</td>
      						<td>${product.minQuantity}</td>
      						<td>${product.category}</td>
                                       <td>
                                           <img src="${product.img}" alt="${product.image}" width="150" height="120">
                                       </td>
      						<td><div id="edit-quantity" productId='${product._id}'><i style="cursor:pointer;" class="fa fa-light fa-pen"></i></div></td>
                                   </tr>
                               `;
            });

            document.querySelector("tbody").innerHTML = myTables;

            document.querySelectorAll("#edit-quantity").forEach((element) => {
              element.addEventListener("click", async () => {
                const quantity = prompt("Please enter the new quantity");
                const productId = element.getAttribute("productId");
                try {
                  const response = await fetch(
                    `/update-quantity/${productId}/${quantity}`
                  );
                  if (response.status == 200) {
                    location.reload();
                  }
                } catch (err) {
                  alert("Error ");
                }
              });
            });
          });
      }
    </script>

    <!--[if IE 6]>
      <link href="css/ie6.css" rel="stylesheet" type="text/css" />
    <![endif]-->
    <!--[if IE 7]>
      <link href="css/ie7.css" rel="stylesheet" type="text/css" />
    <![endif]-->
  </head>

  <body onload="showTable()">
    <div id="header">
      <a href="index.html" id="logo"
        ><img src="images/logo.gif" width="310" height="114" alt="" title=""
      /></a>
    </div>
    <br /><br /><br />
    <div id="adminButtons">
      <div id="addBtn" class="button-4" role="button" class="adminButton">
        Add Product
      </div>

      <div id="filterBtn" class="button-4" role="button" class="adminButton">
        Filter
      </div>

      <a href="permissions.html">
        <div class="button-4" role="button" class="adminButton">
          Manage Users
        </div>
      </a>
    </div>
    <div id="myData">
      <table class="styled-table">
        <thead>
          <tr>
            <th>Product Name</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Minimum Quantity</th>
            <th>Category</th>
            <th>Image</th>
            <th>Edit</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- The Modal -->
    <div id="addProductModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <p style="text-align: center">Add Product</p>
        <form id="new-product" method="post" action="/newProduct">
          <div class="group">
            <input name="name" type="text" required />
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>Name</label>
          </div>

          <div class="group">
            <input name="price" type="text" required />
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>Price</label>
          </div>

          <div class="group">
            <input name="quantity" type="text" required />
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>Quantity</label>
          </div>

          <div class="group">
            <input name="minQuantity" type="text" required />
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>Minimum Quantity</label>
          </div>

          <div class="group">
            <input name="img" type="text" required />
            <span class="highlight"></span>
            <span class="bar"></span>
            <label>Image Url</label>
          </div>
          <div class="group">
            <label>Category</label><br /><br />
            <select
              style="font-family: sora; font-size: 14px"
              name="category"
              id="category"
              form="new-product"
            >
              <option value="Beds" selected="selected">Beds</option>
              <option value="Food" selected="selected">Food</option>
              <option value="Grooming" selected="selected">Grooming</option>
              <option value="Toys" selected="selected">Toys</option>
            </select>
          </div>
          <button type="submit" class="button-4 adminButton" role="button">
            Add
          </button>
        </form>
      </div>

      <!-- The Modal -->
    </div>
    <div id="filterModal" class="modal">
      <!-- Modal content -->
      <div class="modal-content">
        <span class="close">&times;</span>
        <!--FOR THE FILTER BUTTON-->
        <div class="group">
          <label>Category</label><br /><br />
          <select
            style="font-family: sora; font-size: 14px"
            name="subject"
            id="category-filter"
          >
            <option value="Toys" selected="selected">Toys</option>
            <option value="Beds" selected="selected">Beds</option>
            <option value="Food" selected="selected">Food</option>
            <option value="Grooming" selected="selected">Grooming</option>
            <option value="all" selected="selected">Show All</option>
          </select>
        </div>

        <input style="margin-left: -125px" type="checkbox" />
        <p>Show Missing Products</p>

        <div id="filter-now" class="button-4" role="button" class="adminButton">
          Filter
        </div>
      </div>
    </div>
    <script src="modal.js" defer></script>
  </body>
</html>
